<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>JJ3S</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.3/require.min.js"></script>
    <style type="text/css" media="screen">
body {
  overflow: hidden;
  display: flex;
  width: 100vw;
  height: 100vh;
  margin: 0;
}
#editor {
  margin: 0;
  width: 50%;
}
#display {
  margin: 0;
  width: 50%;
  border-left: 3px solid #141411;
}
::-webkit-scrollbar {
    width: 0.5em;
}

::-webkit-scrollbar-track {
    box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
}

::-webkit-scrollbar-thumb {
    background: rgba(100, 100, 100, 0.8);
}

::-webkit-scrollbar-corner,
::-webkit-scrollbar-thumb:window-inactive {
    background: rgba(100, 100, 100, 0.4);
}
::-webkit-scrollbar-thumb:hover {
    background: rgba(100, 100, 100, 1.0);
}
    </style>
  </head>
  <body>
    <pre id="editor"></pre>
    <div id="display">
      <canvas id="canvas" width="640" height="480">
    </div>
    <script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
let vim,emacs;
$(_=>{
  let clear = _=>_;
  function srcUpdate(src){
    localStorage.setItem('src',src);
    console.log(src); // TODO
  }
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.setFontSize(20);
  editor.session.setMode("ace/mode/ex3");
  const initSource = localStorage.getItem('src');
  if(initSource){
    editor.session.getDocument().setValue(initSource);
  }
  let editTimer = null;
  editor.on('change',_=>{
    if(editTimer)clearTimeout(editTimer);
    editTimer = setTimeout(_=>{
      let content = editor.session.getDocument().getValue();
      srcUpdate(content);
      clear();
    },2000);
  });
  vim = _=>{editor.setKeyboardHandler("ace/keyboard/vim");localStorage.setItem('inputMethod',"vim");}
  emacs = _=>{editor.setKeyboardHandler("ace/keyboard/emacs");localStorage.setItem('inputMethod',"emacs");}
  const im = localStorage.getItem('inputMethod');
  if(im){
    if(im=="vim")vim();
    else if(im=="emacs")emacs();
  }
});
    </script>
  </body>
</html>
